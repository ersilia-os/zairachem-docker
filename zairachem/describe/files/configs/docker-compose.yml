version: "3.9"
services:
  redis_zairachem:
    container_name: redis
    image: redis:latest
    command: ["redis-server", "--appendonly", "yes"]
    restart: unless-stopped
    ports:
      - "6379:6379" 
    volumes:
      - redis_data:/data
    networks:
      - ersilia_network
  nginx:
    image: nginx:alpine
    depends_on:
      - eos2gw4_api
      - eos4u6p_api
      - eos5axz_api
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
      - nginx_cache:/var/cache/nginx
    restart: unless-stopped
    networks:
      - ersilia_network
  eos2gw4_api:
    image: ersiliaos/eos2gw4
    environment:
      REDIS_HOST: redis
      REDIS_PORT: "6379"
      REDIS_URI: "redis://redis:6379"
      REDIS_EXPIRATION: "604800"
    restart: unless-stopped
    ports:
      - "46017:80"
    networks:
      - ersilia_network
    depends_on:
      - redis_zairachem
  eos4u6p_api:
    image: ersiliaos/eos4u6p
    environment:
      REDIS_HOST: redis
      REDIS_PORT: "6379"
      REDIS_URI: "redis://redis:6379"
      REDIS_EXPIRATION: "604800"
    restart: unless-stopped
    ports:
      - "39071:80"
    networks:
      - ersilia_network
    depends_on:
      - redis_zairachem
  eos5axz_api:
    image: ersiliaos/eos5axz
    environment:
      REDIS_HOST: redis
      REDIS_PORT: "6379"
      REDIS_URI: "redis://redis:6379"
      REDIS_EXPIRATION: "604800"
    restart: unless-stopped
    ports:
      - "35445:80"
    networks:
      - ersilia_network
    depends_on:
      - redis_zairachem
networks:
  ersilia_network:
    external: true
    name: ersilia_network
    driver: bridge

volumes:
  redis_data:
  nginx_cache:
